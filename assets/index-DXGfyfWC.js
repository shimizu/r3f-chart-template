const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./raw-in9isEBO.js","./basedecoder-B2c5_Eok.js","./lzw-_aCqfs4w.js","./jpeg-vtRboCKw.js","./deflate-B9JhHpvg.js","./pako.esm-Cram60i4.js","./packbits-DDWKfGV_.js","./lerc-BzUVZzEg.js","./react-OvXVS5lI.js","./fiber-DjIKX-WJ.js","./three-CBnsgdK7.js","./drei-DoqR3qId.js","./zstd-DD6JHAQz.js","./webimage-DBgUwIbt.js"])))=>i.map(i=>d[i]);
import{r as F,j as b,R as pt,C as Ir}from"./fiber-DjIKX-WJ.js";import{_ as Y,T as te,O as je,I as Lt,a as zt,c as Ar}from"./drei-DoqR3qId.js";import{G as yt,C as kr,X as Dr,F as Er}from"./three-CBnsgdK7.js";import"./react-OvXVS5lI.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();function ke(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Cr(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function $t(t){let e,r,n;t.length!==2?(e=ke,r=(o,f)=>ke(t(o),f),n=(o,f)=>t(o)-f):(e=t===ke||t===Cr?t:_r,r=t,n=t);function i(o,f,c=0,h=o.length){if(c<h){if(e(f,f)!==0)return h;do{const l=c+h>>>1;r(o[l],f)<0?c=l+1:h=l}while(c<h)}return c}function a(o,f,c=0,h=o.length){if(c<h){if(e(f,f)!==0)return h;do{const l=c+h>>>1;r(o[l],f)<=0?c=l+1:h=l}while(c<h)}return c}function s(o,f,c=0,h=o.length){const l=i(o,f,c,h-1);return l>c&&n(o[l-1],f)>-n(o[l],f)?l-1:l}return{left:i,center:s,right:a}}function _r(){return 0}function vr(t){return t===null?NaN:+t}const Nr=$t(ke),jr=Nr.right;$t(vr).center;function Pr(t,e){let r,n;for(const i of t)i!=null&&(r===void 0?i>=i&&(r=n=i):(r>i&&(r=i),n<i&&(n=i)));return[r,n]}const Or=Math.sqrt(50),Rr=Math.sqrt(10),Fr=Math.sqrt(2);function De(t,e,r){const n=(e-t)/Math.max(0,r),i=Math.floor(Math.log10(n)),a=n/Math.pow(10,i),s=a>=Or?10:a>=Rr?5:a>=Fr?2:1;let o,f,c;return i<0?(c=Math.pow(10,-i)/s,o=Math.round(t*c),f=Math.round(e*c),o/c<t&&++o,f/c>e&&--f,c=-c):(c=Math.pow(10,i)*s,o=Math.round(t/c),f=Math.round(e/c),o*c<t&&++o,f*c>e&&--f),f<o&&.5<=r&&r<2?De(t,e,r*2):[o,f,c]}function Br(t,e,r){if(e=+e,t=+t,r=+r,!(r>0))return[];if(t===e)return[t];const n=e<t,[i,a,s]=n?De(e,t,r):De(t,e,r);if(!(a>=i))return[];const o=a-i+1,f=new Array(o);if(n)if(s<0)for(let c=0;c<o;++c)f[c]=(a-c)/-s;else for(let c=0;c<o;++c)f[c]=(a-c)*s;else if(s<0)for(let c=0;c<o;++c)f[c]=(i+c)/-s;else for(let c=0;c<o;++c)f[c]=(i+c)*s;return f}function Ye(t,e,r){return e=+e,t=+t,r=+r,De(t,e,r)[2]}function Gr(t,e,r){e=+e,t=+t,r=+r;const n=e<t,i=n?Ye(e,t,r):Ye(t,e,r);return(n?-1:1)*(i<0?1/-i:i)}function Ur(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Lr(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}function nt(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function Vt(t,e){var r=Object.create(t.prototype);for(var n in e)r[n]=e[n];return r}function xe(){}var de=.7,Ee=1/de,ne="\\s*([+-]?\\d+)\\s*",ge="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",z="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",zr=/^#([0-9a-f]{3,8})$/,$r=new RegExp(`^rgb\\(${ne},${ne},${ne}\\)$`),Vr=new RegExp(`^rgb\\(${z},${z},${z}\\)$`),qr=new RegExp(`^rgba\\(${ne},${ne},${ne},${ge}\\)$`),Kr=new RegExp(`^rgba\\(${z},${z},${z},${ge}\\)$`),Hr=new RegExp(`^hsl\\(${ge},${z},${z}\\)$`),Yr=new RegExp(`^hsla\\(${ge},${z},${z},${ge}\\)$`),wt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};nt(xe,be,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:St,formatHex:St,formatHex8:Xr,formatHsl:Zr,formatRgb:Mt,toString:Mt});function St(){return this.rgb().formatHex()}function Xr(){return this.rgb().formatHex8()}function Zr(){return qt(this).formatHsl()}function Mt(){return this.rgb().formatRgb()}function be(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=zr.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?Tt(e):r===3?new j(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?Se(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?Se(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=$r.exec(t))?new j(e[1],e[2],e[3],1):(e=Vr.exec(t))?new j(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=qr.exec(t))?Se(e[1],e[2],e[3],e[4]):(e=Kr.exec(t))?Se(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Hr.exec(t))?kt(e[1],e[2]/100,e[3]/100,1):(e=Yr.exec(t))?kt(e[1],e[2]/100,e[3]/100,e[4]):wt.hasOwnProperty(t)?Tt(wt[t]):t==="transparent"?new j(NaN,NaN,NaN,0):null}function Tt(t){return new j(t>>16&255,t>>8&255,t&255,1)}function Se(t,e,r,n){return n<=0&&(t=e=r=NaN),new j(t,e,r,n)}function Jr(t){return t instanceof xe||(t=be(t)),t?(t=t.rgb(),new j(t.r,t.g,t.b,t.opacity)):new j}function Xe(t,e,r,n){return arguments.length===1?Jr(t):new j(t,e,r,n??1)}function j(t,e,r,n){this.r=+t,this.g=+e,this.b=+r,this.opacity=+n}nt(j,Xe,Vt(xe,{brighter(t){return t=t==null?Ee:Math.pow(Ee,t),new j(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?de:Math.pow(de,t),new j(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new j(Z(this.r),Z(this.g),Z(this.b),Ce(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:It,formatHex:It,formatHex8:Qr,formatRgb:At,toString:At}));function It(){return`#${X(this.r)}${X(this.g)}${X(this.b)}`}function Qr(){return`#${X(this.r)}${X(this.g)}${X(this.b)}${X((isNaN(this.opacity)?1:this.opacity)*255)}`}function At(){const t=Ce(this.opacity);return`${t===1?"rgb(":"rgba("}${Z(this.r)}, ${Z(this.g)}, ${Z(this.b)}${t===1?")":`, ${t})`}`}function Ce(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Z(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function X(t){return t=Z(t),(t<16?"0":"")+t.toString(16)}function kt(t,e,r,n){return n<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new B(t,e,r,n)}function qt(t){if(t instanceof B)return new B(t.h,t.s,t.l,t.opacity);if(t instanceof xe||(t=be(t)),!t)return new B;if(t instanceof B)return t;t=t.rgb();var e=t.r/255,r=t.g/255,n=t.b/255,i=Math.min(e,r,n),a=Math.max(e,r,n),s=NaN,o=a-i,f=(a+i)/2;return o?(e===a?s=(r-n)/o+(r<n)*6:r===a?s=(n-e)/o+2:s=(e-r)/o+4,o/=f<.5?a+i:2-a-i,s*=60):o=f>0&&f<1?0:s,new B(s,o,f,t.opacity)}function Wr(t,e,r,n){return arguments.length===1?qt(t):new B(t,e,r,n??1)}function B(t,e,r,n){this.h=+t,this.s=+e,this.l=+r,this.opacity=+n}nt(B,Wr,Vt(xe,{brighter(t){return t=t==null?Ee:Math.pow(Ee,t),new B(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?de:Math.pow(de,t),new B(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*e,i=2*r-n;return new j(Ge(t>=240?t-240:t+120,i,n),Ge(t,i,n),Ge(t<120?t+240:t-120,i,n),this.opacity)},clamp(){return new B(Dt(this.h),Me(this.s),Me(this.l),Ce(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ce(this.opacity);return`${t===1?"hsl(":"hsla("}${Dt(this.h)}, ${Me(this.s)*100}%, ${Me(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Dt(t){return t=(t||0)%360,t<0?t+360:t}function Me(t){return Math.max(0,Math.min(1,t||0))}function Ge(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}const it=t=>()=>t;function en(t,e){return function(r){return t+r*e}}function tn(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(n){return Math.pow(t+n*e,r)}}function rn(t){return(t=+t)==1?Kt:function(e,r){return r-e?tn(e,r,t):it(isNaN(e)?r:e)}}function Kt(t,e){var r=e-t;return r?en(t,r):it(isNaN(t)?e:t)}const Et=(function t(e){var r=rn(e);function n(i,a){var s=r((i=Xe(i)).r,(a=Xe(a)).r),o=r(i.g,a.g),f=r(i.b,a.b),c=Kt(i.opacity,a.opacity);return function(h){return i.r=s(h),i.g=o(h),i.b=f(h),i.opacity=c(h),i+""}}return n.gamma=t,n})(1);function nn(t,e){e||(e=[]);var r=t?Math.min(e.length,t.length):0,n=e.slice(),i;return function(a){for(i=0;i<r;++i)n[i]=t[i]*(1-a)+e[i]*a;return n}}function an(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function sn(t,e){var r=e?e.length:0,n=t?Math.min(r,t.length):0,i=new Array(n),a=new Array(r),s;for(s=0;s<n;++s)i[s]=Pe(t[s],e[s]);for(;s<r;++s)a[s]=e[s];return function(o){for(s=0;s<n;++s)a[s]=i[s](o);return a}}function on(t,e){var r=new Date;return t=+t,e=+e,function(n){return r.setTime(t*(1-n)+e*n),r}}function _e(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}function cn(t,e){var r={},n={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?r[i]=Pe(t[i],e[i]):n[i]=e[i];return function(a){for(i in r)n[i]=r[i](a);return n}}var Ze=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ue=new RegExp(Ze.source,"g");function fn(t){return function(){return t}}function ln(t){return function(e){return t(e)+""}}function hn(t,e){var r=Ze.lastIndex=Ue.lastIndex=0,n,i,a,s=-1,o=[],f=[];for(t=t+"",e=e+"";(n=Ze.exec(t))&&(i=Ue.exec(e));)(a=i.index)>r&&(a=e.slice(r,a),o[s]?o[s]+=a:o[++s]=a),(n=n[0])===(i=i[0])?o[s]?o[s]+=i:o[++s]=i:(o[++s]=null,f.push({i:s,x:_e(n,i)})),r=Ue.lastIndex;return r<e.length&&(a=e.slice(r),o[s]?o[s]+=a:o[++s]=a),o.length<2?f[0]?ln(f[0].x):fn(e):(e=f.length,function(c){for(var h=0,l;h<e;++h)o[(l=f[h]).i]=l.x(c);return o.join("")})}function Pe(t,e){var r=typeof e,n;return e==null||r==="boolean"?it(e):(r==="number"?_e:r==="string"?(n=be(e))?(e=n,Et):hn:e instanceof be?Et:e instanceof Date?on:an(e)?nn:Array.isArray(e)?sn:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?cn:_e)(t,e)}function Ht(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}}function un(t){return function(){return t}}function dn(t){return+t}var Ct=[0,1];function H(t){return t}function Je(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:un(isNaN(e)?NaN:.5)}function gn(t,e){var r;return t>e&&(r=t,t=e,e=r),function(n){return Math.max(t,Math.min(e,n))}}function bn(t,e,r){var n=t[0],i=t[1],a=e[0],s=e[1];return i<n?(n=Je(i,n),a=r(s,a)):(n=Je(n,i),a=r(a,s)),function(o){return a(n(o))}}function mn(t,e,r){var n=Math.min(t.length,e.length)-1,i=new Array(n),a=new Array(n),s=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<n;)i[s]=Je(t[s],t[s+1]),a[s]=r(e[s],e[s+1]);return function(o){var f=jr(t,o,1,n)-1;return a[f](i[f](o))}}function xn(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function pn(){var t=Ct,e=Ct,r=Pe,n,i,a,s=H,o,f,c;function h(){var u=Math.min(t.length,e.length);return s!==H&&(s=gn(t[0],t[u-1])),o=u>2?mn:bn,f=c=null,l}function l(u){return u==null||isNaN(u=+u)?a:(f||(f=o(t.map(n),e,r)))(n(s(u)))}return l.invert=function(u){return s(i((c||(c=o(e,t.map(n),_e)))(u)))},l.domain=function(u){return arguments.length?(t=Array.from(u,dn),h()):t.slice()},l.range=function(u){return arguments.length?(e=Array.from(u),h()):e.slice()},l.rangeRound=function(u){return e=Array.from(u),r=Ht,h()},l.clamp=function(u){return arguments.length?(s=u?!0:H,h()):s!==H},l.interpolate=function(u){return arguments.length?(r=u,h()):r},l.unknown=function(u){return arguments.length?(a=u,l):a},function(u,g){return n=u,i=g,h()}}function yn(){return pn()(H,H)}function wn(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function ve(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,n=t.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+t.slice(r+1)]}function ae(t){return t=ve(Math.abs(t)),t?t[1]:NaN}function Sn(t,e){return function(r,n){for(var i=r.length,a=[],s=0,o=t[0],f=0;i>0&&o>0&&(f+o+1>n&&(o=Math.max(1,n-f)),a.push(r.substring(i-=o,i+o)),!((f+=o+1)>n));)o=t[s=(s+1)%t.length];return a.reverse().join(e)}}function Mn(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}var Tn=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ne(t){if(!(e=Tn.exec(t)))throw new Error("invalid format: "+t);var e;return new at({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Ne.prototype=at.prototype;function at(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}at.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function In(t){e:for(var e=t.length,r=1,n=-1,i;r<e;++r)switch(t[r]){case".":n=i=r;break;case"0":n===0&&(n=r),i=r;break;default:if(!+t[r])break e;n>0&&(n=0);break}return n>0?t.slice(0,n)+t.slice(i+1):t}var Yt;function An(t,e){var r=ve(t,e);if(!r)return t+"";var n=r[0],i=r[1],a=i-(Yt=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,s=n.length;return a===s?n:a>s?n+new Array(a-s+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+ve(t,Math.max(0,e+a-1))[0]}function _t(t,e){var r=ve(t,e);if(!r)return t+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}const vt={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:wn,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>_t(t*100,e),r:_t,s:An,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Nt(t){return t}var jt=Array.prototype.map,Pt=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function kn(t){var e=t.grouping===void 0||t.thousands===void 0?Nt:Sn(jt.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",n=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",a=t.numerals===void 0?Nt:Mn(jt.call(t.numerals,String)),s=t.percent===void 0?"%":t.percent+"",o=t.minus===void 0?"−":t.minus+"",f=t.nan===void 0?"NaN":t.nan+"";function c(l){l=Ne(l);var u=l.fill,g=l.align,d=l.sign,x=l.symbol,m=l.zero,p=l.width,y=l.comma,w=l.precision,I=l.trim,S=l.type;S==="n"?(y=!0,S="g"):vt[S]||(w===void 0&&(w=12),I=!0,S="g"),(m||u==="0"&&g==="=")&&(m=!0,u="0",g="=");var A=x==="$"?r:x==="#"&&/[boxX]/.test(S)?"0"+S.toLowerCase():"",v=x==="$"?n:/[%p]/.test(S)?s:"",k=vt[S],J=/[defgprs%]/.test(S);w=w===void 0?6:/[gprs]/.test(S)?Math.max(1,Math.min(21,w)):Math.max(0,Math.min(20,w));function Q(T){var R=A,E=v,V,q,W;if(S==="c")E=k(T)+E,T="";else{T=+T;var ee=T<0||1/T<0;if(T=isNaN(T)?f:k(Math.abs(T),w),I&&(T=In(T)),ee&&+T==0&&d!=="+"&&(ee=!1),R=(ee?d==="("?d:o:d==="-"||d==="("?"":d)+R,E=(S==="s"?Pt[8+Yt/3]:"")+E+(ee&&d==="("?")":""),J){for(V=-1,q=T.length;++V<q;)if(W=T.charCodeAt(V),48>W||W>57){E=(W===46?i+T.slice(V+1):T.slice(V))+E,T=T.slice(0,V);break}}}y&&!m&&(T=e(T,1/0));var K=R.length+T.length+E.length,C=K<p?new Array(p-K+1).join(u):"";switch(y&&m&&(T=e(C+T,C.length?p-E.length:1/0),C=""),g){case"<":T=R+T+E+C;break;case"=":T=R+C+T+E;break;case"^":T=C.slice(0,K=C.length>>1)+R+T+E+C.slice(K);break;default:T=C+R+T+E;break}return a(T)}return Q.toString=function(){return l+""},Q}function h(l,u){var g=c((l=Ne(l),l.type="f",l)),d=Math.max(-8,Math.min(8,Math.floor(ae(u)/3)))*3,x=Math.pow(10,-d),m=Pt[8+d/3];return function(p){return g(x*p)+m}}return{format:c,formatPrefix:h}}var Te,Xt,Zt;Dn({thousands:",",grouping:[3],currency:["$",""]});function Dn(t){return Te=kn(t),Xt=Te.format,Zt=Te.formatPrefix,Te}function En(t){return Math.max(0,-ae(Math.abs(t)))}function Cn(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(ae(e)/3)))*3-ae(Math.abs(t)))}function _n(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,ae(e)-ae(t))+1}function vn(t,e,r,n){var i=Gr(t,e,r),a;switch(n=Ne(n??",f"),n.type){case"s":{var s=Math.max(Math.abs(t),Math.abs(e));return n.precision==null&&!isNaN(a=Cn(i,s))&&(n.precision=a),Zt(n,s)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(a=_n(i,Math.max(Math.abs(t),Math.abs(e))))&&(n.precision=a-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(a=En(i))&&(n.precision=a-(n.type==="%")*2);break}}return Xt(n)}function Jt(t){var e=t.domain;return t.ticks=function(r){var n=e();return Br(n[0],n[n.length-1],r??10)},t.tickFormat=function(r,n){var i=e();return vn(i[0],i[i.length-1],r??10,n)},t.nice=function(r){r==null&&(r=10);var n=e(),i=0,a=n.length-1,s=n[i],o=n[a],f,c,h=10;for(o<s&&(c=s,s=o,o=c,c=i,i=a,a=c);h-- >0;){if(c=Ye(s,o,r),c===f)return n[i]=s,n[a]=o,e(n);if(c>0)s=Math.floor(s/c)*c,o=Math.ceil(o/c)*c;else if(c<0)s=Math.ceil(s*c)/c,o=Math.floor(o*c)/c;else break;f=c}return t},t}function P(){var t=yn();return t.copy=function(){return xn(t,P())},Ur.apply(t,arguments),Jt(t)}function Nn(){var t=0,e=1,r,n,i,a,s=H,o=!1,f;function c(l){return l==null||isNaN(l=+l)?f:s(i===0?.5:(l=(a(l)-r)*i,o?Math.max(0,Math.min(1,l)):l))}c.domain=function(l){return arguments.length?([t,e]=l,r=a(t=+t),n=a(e=+e),i=r===n?0:1/(n-r),c):[t,e]},c.clamp=function(l){return arguments.length?(o=!!l,c):o},c.interpolator=function(l){return arguments.length?(s=l,c):s};function h(l){return function(u){var g,d;return arguments.length?([g,d]=u,s=l(g,d),c):[s(0),s(1)]}}return c.range=h(Pe),c.rangeRound=h(Ht),c.unknown=function(l){return arguments.length?(f=l,c):f},function(l){return a=l,r=l(t),n=l(e),i=r===n?0:1/(n-r),c}}function jn(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function st(){var t=Jt(Nn()(H));return t.copy=function(){return jn(t,st())},Lr.apply(t,arguments)}function Oe(t){for(var e=t.length/6|0,r=new Array(e),n=0;n<e;)r[n]="#"+t.slice(n*6,++n*6);return r}function Qt(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+t*(1172.33-t*(10793.56-t*(33300.12-t*(38394.49-t*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+t*(557.33+t*(1225.33-t*(3574.96-t*(1073.77+t*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+t*(3211.1-t*(15327.97-t*(27814-t*(22569.18-t*6838.66)))))))+")"}function Re(t){var e=t.length;return function(r){return t[Math.max(0,Math.min(e-1,Math.floor(r*e)))]}}const Pn=Re(Oe("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));Re(Oe("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf"));Re(Oe("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4"));Re(Oe("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function D(t){return(e,...r)=>On(t,e,r)}function oe(t,e){return D(Wt(t,e).get)}const{apply:On,getOwnPropertyDescriptor:Wt,getPrototypeOf:ot,ownKeys:Rn}=Reflect,{iterator:pe,toStringTag:Fn}=Symbol,Bn=Object,{create:ct,defineProperty:Gn}=Bn,Un=Array,Ln=Un.prototype,er=Ln[pe],zn=D(er),tr=ArrayBuffer,$n=tr.prototype;oe($n,"byteLength");const Ot=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;Ot&&oe(Ot.prototype,"byteLength");const rr=ot(Uint8Array);rr.from;const _=rr.prototype;_[pe];D(_.keys);D(_.values);D(_.entries);D(_.set);D(_.reverse);D(_.fill);D(_.copyWithin);D(_.sort);D(_.slice);D(_.subarray);oe(_,"buffer");oe(_,"byteOffset");oe(_,"length");oe(_,Fn);const Vn=Uint8Array,nr=Uint16Array,ft=Uint32Array,qn=Float32Array,me=ot([][pe]()),ir=D(me.next),Kn=D((function*(){})().next),Hn=ot(me),Yn=DataView.prototype,Xn=D(Yn.getUint16),lt=WeakMap,ar=lt.prototype,sr=D(ar.get),Zn=D(ar.set),or=new lt,Jn=ct(null,{next:{value:function(){const e=sr(or,this);return ir(e)}},[pe]:{value:function(){return this}}});function Qn(t){if(t[pe]===er&&me.next===ir)return t;const e=ct(Jn);return Zn(or,e,zn(t)),e}const Wn=new lt,ei=ct(Hn,{next:{value:function(){const e=sr(Wn,this);return Kn(e)},writable:!0,configurable:!0}});for(const t of Rn(me))t!=="next"&&Gn(ei,t,Wt(me,t));const cr=new tr(4),ti=new qn(cr),ri=new ft(cr),G=new nr(512),U=new Vn(512);for(let t=0;t<256;++t){const e=t-127;e<-24?(G[t]=0,G[t|256]=32768,U[t]=24,U[t|256]=24):e<-14?(G[t]=1024>>-e-14,G[t|256]=1024>>-e-14|32768,U[t]=-e-1,U[t|256]=-e-1):e<=15?(G[t]=e+15<<10,G[t|256]=e+15<<10|32768,U[t]=13,U[t|256]=13):e<128?(G[t]=31744,G[t|256]=64512,U[t]=24,U[t|256]=24):(G[t]=31744,G[t|256]=64512,U[t]=13,U[t|256]=13)}const ht=new ft(2048);for(let t=1;t<1024;++t){let e=t<<13,r=0;for(;(e&8388608)===0;)e<<=1,r-=8388608;e&=-8388609,r+=947912704,ht[t]=e|r}for(let t=1024;t<2048;++t)ht[t]=939524096+(t-1024<<13);const ce=new ft(64);for(let t=1;t<31;++t)ce[t]=t<<23;ce[31]=1199570944;ce[32]=2147483648;for(let t=33;t<63;++t)ce[t]=2147483648+(t-32<<23);ce[63]=3347054592;const fr=new nr(64);for(let t=1;t<64;++t)t!==32&&(fr[t]=1024);function ni(t){const e=t>>10;return ri[0]=ht[fr[e]+(t&1023)]+ce[e],ti[0]}function lr(t,e,...r){return ni(Xn(t,e,...Qn(r)))}function Le(t,e,r){const n=typeof t=="object"?t.outer:t,i=n.slice(0,n.indexOf(">")+1),a=['"',"'"];for(let s=0;s<a.length;s++){const o=a[s],f=e+"\\="+o+"([^"+o+"]*)"+o,h=new RegExp(f).exec(i);if(h)return h[1]}}function ii(t,e,r){const i=new RegExp(e).exec(t.slice(r));return i?r+i.index:-1}function ze(t,e,r){const i=new RegExp(e).exec(t.slice(r));return i?r+i.index+i[0].length-1:-1}function Rt(t,e){const r=new RegExp(e,"g"),n=t.match(r);return n?n.length:0}function ai(t,e,r){const n=r&&r.debug||!1,i=!(r&&typeof r.nested===!1),a=r&&r.startIndex||0;n&&console.log("[xml-utils] starting findTagByName with",e," and ",r);const s=ii(t,`<${e}[ 
>/]`,a);if(n&&console.log("[xml-utils] start:",s),s===-1)return;const o=t.slice(s+e.length);let f=ze(o,"^[^<]*[ /]>",0);const c=f!==-1&&o[f-1]==="/";if(n&&console.log("[xml-utils] selfClosing:",c),c===!1)if(i){let g=0,d=1,x=0;for(;(f=ze(o,"[ /]"+e+">",g))!==-1;){const m=o.substring(g,f+1);if(d+=Rt(m,"<"+e+`[ 
	>]`),x+=Rt(m,"</"+e+">"),x>=d)break;g=f}}else f=ze(o,"[ /]"+e+">",0);const h=s+e.length+f+1;if(n&&console.log("[xml-utils] end:",h),h===-1)return;const l=t.slice(s,h);let u;return c?u=null:u=l.slice(l.indexOf(">")+1,l.lastIndexOf("<")),{inner:u,outer:l,start:s,end:h}}function si(t,e,r){const n=[];let a=0,s;for(;s=ai(t,e,{debug:!1,startIndex:a});)a=s.start+1+e.length,n.push(s);return n}const ue={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34412:"CZ_LSMINFO",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},L={};for(const t in ue)ue.hasOwnProperty(t)&&(L[ue[t]]=parseInt(t,10));const oi=[L.BitsPerSample,L.ExtraSamples,L.SampleFormat,L.StripByteCounts,L.StripOffsets,L.StripRowCounts,L.TileByteCounts,L.TileOffsets,L.SubIFDs],$e={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},M={};for(const t in $e)$e.hasOwnProperty(t)&&(M[$e[t]]=parseInt(t,10));const O={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8},ci={Unspecified:0},Da={AddCompression:1},Ea={None:0,Deflate:1,Zstandard:2},fi={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function li(t,e){const{width:r,height:n}=t,i=new Uint8Array(r*n*3);let a;for(let s=0,o=0;s<t.length;++s,o+=3)a=256-t[s]/e*256,i[o]=a,i[o+1]=a,i[o+2]=a;return i}function hi(t,e){const{width:r,height:n}=t,i=new Uint8Array(r*n*3);let a;for(let s=0,o=0;s<t.length;++s,o+=3)a=t[s]/e*256,i[o]=a,i[o+1]=a,i[o+2]=a;return i}function ui(t,e){const{width:r,height:n}=t,i=new Uint8Array(r*n*3),a=e.length/3,s=e.length/3*2;for(let o=0,f=0;o<t.length;++o,f+=3){const c=t[o];i[f]=e[c]/65536*256,i[f+1]=e[c+a]/65536*256,i[f+2]=e[c+s]/65536*256}return i}function di(t){const{width:e,height:r}=t,n=new Uint8Array(e*r*3);for(let i=0,a=0;i<t.length;i+=4,a+=3){const s=t[i],o=t[i+1],f=t[i+2],c=t[i+3];n[a]=255*((255-s)/256)*((255-c)/256),n[a+1]=255*((255-o)/256)*((255-c)/256),n[a+2]=255*((255-f)/256)*((255-c)/256)}return n}function gi(t){const{width:e,height:r}=t,n=new Uint8ClampedArray(e*r*3);for(let i=0,a=0;i<t.length;i+=3,a+=3){const s=t[i],o=t[i+1],f=t[i+2];n[a]=s+1.402*(f-128),n[a+1]=s-.34414*(o-128)-.71414*(f-128),n[a+2]=s+1.772*(o-128)}return n}const bi=.95047,mi=1,xi=1.08883;function pi(t){const{width:e,height:r}=t,n=new Uint8Array(e*r*3);for(let i=0,a=0;i<t.length;i+=3,a+=3){const s=t[i+0],o=t[i+1]<<24>>24,f=t[i+2]<<24>>24;let c=(s+16)/116,h=o/500+c,l=c-f/200,u,g,d;h=bi*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),c=mi*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),l=xi*(l*l*l>.008856?l*l*l:(l-16/116)/7.787),u=h*3.2406+c*-1.5372+l*-.4986,g=h*-.9689+c*1.8758+l*.0415,d=h*.0557+c*-.204+l*1.057,u=u>.0031308?1.055*u**(1/2.4)-.055:12.92*u,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,n[a]=Math.max(0,Math.min(1,u))*255,n[a+1]=Math.max(0,Math.min(1,g))*255,n[a+2]=Math.max(0,Math.min(1,d))*255}return n}const hr=new Map,yi=new Map;function $(t,e,r=!0){Array.isArray(t)||(t=[t]),t.forEach(n=>{hr.set(n,e),yi.set(n,r)})}async function wi(t){const e=hr.get(t.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${t.Compression}`);const r=await e();return new r(t)}$([void 0,1],()=>Y(()=>import("./raw-in9isEBO.js"),__vite__mapDeps([0,1]),import.meta.url).then(t=>t.default),!1);$(5,()=>Y(()=>import("./lzw-_aCqfs4w.js"),__vite__mapDeps([2,1]),import.meta.url).then(t=>t.default));$(6,()=>{throw new Error("old style JPEG compression is not supported.")});$(7,()=>Y(()=>import("./jpeg-vtRboCKw.js"),__vite__mapDeps([3,1]),import.meta.url).then(t=>t.default));$([8,32946],()=>Y(()=>import("./deflate-B9JhHpvg.js"),__vite__mapDeps([4,5,1]),import.meta.url).then(t=>t.default));$(32773,()=>Y(()=>import("./packbits-DDWKfGV_.js"),__vite__mapDeps([6,1]),import.meta.url).then(t=>t.default));$(34887,()=>Y(()=>import("./lerc-BzUVZzEg.js"),__vite__mapDeps([7,5,8,1,9,10,11]),import.meta.url).then(async t=>(await t.zstd.init(),t)).then(t=>t.default));$(5e4,()=>Y(()=>import("./zstd-DD6JHAQz.js"),__vite__mapDeps([12,1]),import.meta.url).then(async t=>(await t.zstd.init(),t)).then(t=>t.default));$(50001,()=>Y(()=>import("./webimage-DBgUwIbt.js"),__vite__mapDeps([13,1]),import.meta.url).then(t=>t.default),!1);function Fe(t,e,r,n=1){return new(Object.getPrototypeOf(t)).constructor(e*r*n)}function Si(t,e,r,n,i){const a=e/n,s=r/i;return t.map(o=>{const f=Fe(o,n,i);for(let c=0;c<i;++c){const h=Math.min(Math.round(s*c),r-1);for(let l=0;l<n;++l){const u=Math.min(Math.round(a*l),e-1),g=o[h*e+u];f[c*n+l]=g}}return f})}function ie(t,e,r){return(1-r)*t+r*e}function Mi(t,e,r,n,i){const a=e/n,s=r/i;return t.map(o=>{const f=Fe(o,n,i);for(let c=0;c<i;++c){const h=s*c,l=Math.floor(h),u=Math.min(Math.ceil(h),r-1);for(let g=0;g<n;++g){const d=a*g,x=d%1,m=Math.floor(d),p=Math.min(Math.ceil(d),e-1),y=o[l*e+m],w=o[l*e+p],I=o[u*e+m],S=o[u*e+p],A=ie(ie(y,w,x),ie(I,S,x),h%1);f[c*n+g]=A}}return f})}function Ti(t,e,r,n,i,a="nearest"){switch(a.toLowerCase()){case"nearest":return Si(t,e,r,n,i);case"bilinear":case"linear":return Mi(t,e,r,n,i);default:throw new Error(`Unsupported resampling method: '${a}'`)}}function Ii(t,e,r,n,i,a){const s=e/n,o=r/i,f=Fe(t,n,i,a);for(let c=0;c<i;++c){const h=Math.min(Math.round(o*c),r-1);for(let l=0;l<n;++l){const u=Math.min(Math.round(s*l),e-1);for(let g=0;g<a;++g){const d=t[h*e*a+u*a+g];f[c*n*a+l*a+g]=d}}}return f}function Ai(t,e,r,n,i,a){const s=e/n,o=r/i,f=Fe(t,n,i,a);for(let c=0;c<i;++c){const h=o*c,l=Math.floor(h),u=Math.min(Math.ceil(h),r-1);for(let g=0;g<n;++g){const d=s*g,x=d%1,m=Math.floor(d),p=Math.min(Math.ceil(d),e-1);for(let y=0;y<a;++y){const w=t[l*e*a+m*a+y],I=t[l*e*a+p*a+y],S=t[u*e*a+m*a+y],A=t[u*e*a+p*a+y],v=ie(ie(w,I,x),ie(S,A,x),h%1);f[c*n*a+g*a+y]=v}}}return f}function ki(t,e,r,n,i,a,s="nearest"){switch(s.toLowerCase()){case"nearest":return Ii(t,e,r,n,i,a);case"bilinear":case"linear":return Ai(t,e,r,n,i,a);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function Di(t,e,r){let n=0;for(let i=e;i<r;++i)n+=t[i];return n}function Qe(t,e,r){switch(t){case 1:if(e<=8)return new Uint8Array(r);if(e<=16)return new Uint16Array(r);if(e<=32)return new Uint32Array(r);break;case 2:if(e===8)return new Int8Array(r);if(e===16)return new Int16Array(r);if(e===32)return new Int32Array(r);break;case 3:switch(e){case 16:case 32:return new Float32Array(r);case 64:return new Float64Array(r)}break}throw Error("Unsupported data format/bitsPerSample")}function Ei(t,e){return(t===1||t===2)&&e<=32&&e%8===0?!1:!(t===3&&(e===16||e===32||e===64))}function Ci(t,e,r,n,i,a,s){const o=new DataView(t),f=r===2?s*a:s*a*n,c=r===2?1:n,h=Qe(e,i,f),l=parseInt("1".repeat(i),2);if(e===1){let u;r===1?u=n*i:u=i;let g=a*u;(g&7)!==0&&(g=g+7&-8);for(let d=0;d<s;++d){const x=d*g;for(let m=0;m<a;++m){const p=x+m*c*i;for(let y=0;y<c;++y){const w=p+y*i,I=(d*a+m)*c+y,S=Math.floor(w/8),A=w%8;if(A+i<=8)h[I]=o.getUint8(S)>>8-i-A&l;else if(A+i<=16)h[I]=o.getUint16(S)>>16-i-A&l;else if(A+i<=24){const v=o.getUint16(S)<<8|o.getUint8(S+2);h[I]=v>>24-i-A&l}else h[I]=o.getUint32(S)>>32-i-A&l}}}}return h.buffer}class _i{constructor(e,r,n,i,a,s){this.fileDirectory=e,this.geoKeys=r,this.dataView=n,this.littleEndian=i,this.tiles=a?{}:null,this.isTiled=!e.StripOffsets;const o=e.PlanarConfiguration;if(this.planarConfiguration=typeof o>"u"?1:o,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=s}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let r=0;r<this.fileDirectory.BitsPerSample.length;++r)e+=this.getSampleByteSize(r);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const r=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,n=this.fileDirectory.BitsPerSample[e];switch(r){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(i,a){return lr(this,i,a)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,r){const n=this.getSampleFormat(e),i=this.getBitsPerSample(e);return Qe(n,i,r)}async getTileOrStrip(e,r,n,i,a){const s=Math.ceil(this.getWidth()/this.getTileWidth()),o=Math.ceil(this.getHeight()/this.getTileHeight());let f;const{tiles:c}=this;this.planarConfiguration===1?f=r*s+e:this.planarConfiguration===2&&(f=n*s*o+r*s+e);let h,l;if(this.isTiled?(h=this.fileDirectory.TileOffsets[f],l=this.fileDirectory.TileByteCounts[f]):(h=this.fileDirectory.StripOffsets[f],l=this.fileDirectory.StripByteCounts[f]),l===0){const d=this.getBlockHeight(r)*this.getTileWidth(),x=this.planarConfiguration===2?this.getSampleByteSize(n):this.getBytesPerPixel(),m=new ArrayBuffer(d*x);return this.getArrayForSample(n,m).fill(this.getGDALNoData()||0),{x:e,y:r,sample:n,data:m}}const u=(await this.source.fetch([{offset:h,length:l}],a))[0];let g;return c===null||!c[f]?(g=(async()=>{let d=await i.decode(this.fileDirectory,u);const x=this.getSampleFormat(),m=this.getBitsPerSample();return Ei(x,m)&&(d=Ci(d,x,this.planarConfiguration,this.getSamplesPerPixel(),m,this.getTileWidth(),this.getBlockHeight(r))),d})(),c!==null&&(c[f]=g)):g=c[f],{x:e,y:r,sample:n,data:await g}}async _readRaster(e,r,n,i,a,s,o,f,c){const h=this.getTileWidth(),l=this.getTileHeight(),u=this.getWidth(),g=this.getHeight(),d=Math.max(Math.floor(e[0]/h),0),x=Math.min(Math.ceil(e[2]/h),Math.ceil(u/h)),m=Math.max(Math.floor(e[1]/l),0),p=Math.min(Math.ceil(e[3]/l),Math.ceil(g/l)),y=e[2]-e[0];let w=this.getBytesPerPixel();const I=[],S=[];for(let k=0;k<r.length;++k)this.planarConfiguration===1?I.push(Di(this.fileDirectory.BitsPerSample,0,r[k])/8):I.push(0),S.push(this.getReaderForSample(r[k]));const A=[],{littleEndian:v}=this;for(let k=m;k<p;++k)for(let J=d;J<x;++J){let Q;this.planarConfiguration===1&&(Q=this.getTileOrStrip(J,k,0,a,c));for(let T=0;T<r.length;++T){const R=T,E=r[T];this.planarConfiguration===2&&(w=this.getSampleByteSize(E),Q=this.getTileOrStrip(J,k,E,a,c));const V=Q.then(q=>{const W=q.data,ee=new DataView(W),K=this.getBlockHeight(q.y),C=q.y*l,ye=q.x*h,pr=C+K,yr=(q.x+1)*h,wr=S[R],Sr=Math.min(K,K-(pr-e[3]),g-C),Mr=Math.min(h,h-(yr-e[2]),u-ye);for(let fe=Math.max(0,e[1]-C);fe<Sr;++fe)for(let le=Math.max(0,e[0]-ye);le<Mr;++le){const Tr=(fe*h+le)*w,xt=wr.call(ee,Tr+I[R],v);let we;i?(we=(fe+C-e[1])*y*r.length+(le+ye-e[0])*r.length+R,n[we]=xt):(we=(fe+C-e[1])*y+le+ye-e[0],n[R][we]=xt)}});A.push(V)}}if(await Promise.all(A),s&&e[2]-e[0]!==s||o&&e[3]-e[1]!==o){let k;return i?k=ki(n,e[2]-e[0],e[3]-e[1],s,o,r.length,f):k=Ti(n,e[2]-e[0],e[3]-e[1],s,o,f),k.width=s,k.height=o,k}return n.width=s||e[2]-e[0],n.height=o||e[3]-e[1],n}async readRasters({window:e,samples:r=[],interleave:n,pool:i=null,width:a,height:s,resampleMethod:o,fillValue:f,signal:c}={}){const h=e||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const l=h[2]-h[0],u=h[3]-h[1],g=l*u,d=this.getSamplesPerPixel();if(!r||!r.length)for(let y=0;y<d;++y)r.push(y);else for(let y=0;y<r.length;++y)if(r[y]>=d)return Promise.reject(new RangeError(`Invalid sample index '${r[y]}'.`));let x;if(n){const y=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,w=Math.max.apply(null,this.fileDirectory.BitsPerSample);x=Qe(y,w,g*r.length),f&&x.fill(f)}else{x=[];for(let y=0;y<r.length;++y){const w=this.getArrayForSample(r[y],g);Array.isArray(f)&&y<f.length?w.fill(f[y]):f&&!Array.isArray(f)&&w.fill(f),x.push(w)}}const m=i||await wi(this.fileDirectory);return await this._readRaster(h,r,x,n,m,a,s,o,c)}async readRGB({window:e,interleave:r=!0,pool:n=null,width:i,height:a,resampleMethod:s,enableAlpha:o=!1,signal:f}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const h=this.fileDirectory.PhotometricInterpretation;if(h===O.RGB){let p=[0,1,2];if(this.fileDirectory.ExtraSamples!==ci.Unspecified&&o){p=[];for(let y=0;y<this.fileDirectory.BitsPerSample.length;y+=1)p.push(y)}return this.readRasters({window:e,interleave:r,samples:p,pool:n,width:i,height:a,resampleMethod:s,signal:f})}let l;switch(h){case O.WhiteIsZero:case O.BlackIsZero:case O.Palette:l=[0];break;case O.CMYK:l=[0,1,2,3];break;case O.YCbCr:case O.CIELab:l=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const u={window:c,interleave:!0,samples:l,pool:n,width:i,height:a,resampleMethod:s,signal:f},{fileDirectory:g}=this,d=await this.readRasters(u),x=2**this.fileDirectory.BitsPerSample[0];let m;switch(h){case O.WhiteIsZero:m=li(d,x);break;case O.BlackIsZero:m=hi(d,x);break;case O.Palette:m=ui(d,g.ColorMap);break;case O.CMYK:m=di(d);break;case O.YCbCr:m=gi(d);break;case O.CIELab:m=pi(d);break;default:throw new Error("Unsupported photometric interpretation.")}if(!r){const p=new Uint8Array(m.length/3),y=new Uint8Array(m.length/3),w=new Uint8Array(m.length/3);for(let I=0,S=0;I<m.length;I+=3,++S)p[S]=m[I],y[S]=m[I+1],w[S]=m[I+2];m=[p,y,w]}return m.width=d.width,m.height=d.height,m}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let r=0;r<this.fileDirectory.ModelTiepoint.length;r+=6)e.push({i:this.fileDirectory.ModelTiepoint[r],j:this.fileDirectory.ModelTiepoint[r+1],k:this.fileDirectory.ModelTiepoint[r+2],x:this.fileDirectory.ModelTiepoint[r+3],y:this.fileDirectory.ModelTiepoint[r+4],z:this.fileDirectory.ModelTiepoint[r+5]});return e}getGDALMetadata(e=null){const r={};if(!this.fileDirectory.GDAL_METADATA)return null;const n=this.fileDirectory.GDAL_METADATA;let i=si(n,"Item");e===null?i=i.filter(a=>Le(a,"sample")===void 0):i=i.filter(a=>Number(Le(a,"sample"))===e);for(let a=0;a<i.length;++a){const s=i[a];r[Le(s,"name")]=s.inner}return r}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,r=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(r)return[r[3],r[7],r[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const r=this.fileDirectory.ModelPixelScale,n=this.fileDirectory.ModelTransformation;if(r)return[r[0],-r[1],r[2]];if(n)return n[1]===0&&n[4]===0?[n[0],-n[5],n[10]]:[Math.sqrt(n[0]*n[0]+n[4]*n[4]),-Math.sqrt(n[1]*n[1]+n[5]*n[5]),n[10]];if(e){const[i,a,s]=e.getResolution();return[i*e.getWidth()/this.getWidth(),a*e.getHeight()/this.getHeight(),s*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const r=this.getHeight(),n=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[i,a,s,o,f,c,h,l]=this.fileDirectory.ModelTransformation,g=[[0,0],[0,r],[n,0],[n,r]].map(([m,p])=>[o+i*m+a*p,l+f*m+c*p]),d=g.map(m=>m[0]),x=g.map(m=>m[1]);return[Math.min(...d),Math.min(...x),Math.max(...d),Math.max(...x)]}else{const i=this.getOrigin(),a=this.getResolution(),s=i[0],o=i[1],f=s+a[0]*n,c=o+a[1]*r;return[Math.min(s,f),Math.min(o,c),Math.max(s,f),Math.max(o,c)]}}}class vi{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,r){const n=this.getUint32(e,r),i=this.getUint32(e+4,r);let a;if(r){if(a=n+2**32*i,!Number.isSafeInteger(a))throw new Error(`${a} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return a}if(a=2**32*n+i,!Number.isSafeInteger(a))throw new Error(`${a} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return a}getInt64(e,r){let n=0;const i=(this._dataView.getUint8(e+(r?7:0))&128)>0;let a=!0;for(let s=0;s<8;s++){let o=this._dataView.getUint8(e+(r?s:7-s));i&&(a?o!==0&&(o=~(o-1)&255,a=!1):o=~o&255),n+=o*256**s}return i&&(n=-n),n}getUint8(e,r){return this._dataView.getUint8(e,r)}getInt8(e,r){return this._dataView.getInt8(e,r)}getUint16(e,r){return this._dataView.getUint16(e,r)}getInt16(e,r){return this._dataView.getInt16(e,r)}getUint32(e,r){return this._dataView.getUint32(e,r)}getInt32(e,r){return this._dataView.getInt32(e,r)}getFloat16(e,r){return lr(this._dataView,e,r)}getFloat32(e,r){return this._dataView.getFloat32(e,r)}getFloat64(e,r){return this._dataView.getFloat64(e,r)}}class Ni{constructor(e,r,n,i){this._dataView=new DataView(e),this._sliceOffset=r,this._littleEndian=n,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,r){return this.sliceOffset<=e&&this.sliceTop>=e+r}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const r=this.readUint32(e),n=this.readUint32(e+4);let i;if(this._littleEndian){if(i=r+2**32*n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*r+n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}readInt64(e){let r=0;const n=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let i=!0;for(let a=0;a<8;a++){let s=this._dataView.getUint8(e+(this._littleEndian?a:7-a));n&&(i?s!==0&&(s=~(s-1)&255,i=!1):s=~s&255),r+=s*256**a}return n&&(r=-r),r}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const Ft=`\r
\r
`;function ur(t){if(typeof Object.fromEntries<"u")return Object.fromEntries(t);const e={};for(const[r,n]of t)e[r.toLowerCase()]=n;return e}function ji(t){const e=t.split(`\r
`).map(r=>{const n=r.split(":").map(i=>i.trim());return n[0]=n[0].toLowerCase(),n});return ur(e)}function Pi(t){const[e,...r]=t.split(";").map(i=>i.trim()),n=r.map(i=>i.split("="));return{type:e,params:ur(n)}}function We(t){let e,r,n;return t&&([,e,r,n]=t.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),r=parseInt(r,10),n=parseInt(n,10)),{start:e,end:r,total:n}}function Oi(t,e){let r=null;const n=new TextDecoder("ascii"),i=[],a=`--${e}`,s=`${a}--`;for(let o=0;o<10;++o)n.decode(new Uint8Array(t,o,a.length))===a&&(r=o);if(r===null)throw new Error("Could not find initial boundary");for(;r<t.byteLength;){const o=n.decode(new Uint8Array(t,r,Math.min(a.length+1024,t.byteLength-r)));if(o.length===0||o.startsWith(s))break;if(!o.startsWith(a))throw new Error("Part does not start with boundary");const f=o.substr(a.length+2);if(f.length===0)break;const c=f.indexOf(Ft),h=ji(f.substr(0,c)),{start:l,end:u,total:g}=We(h["content-range"]),d=r+a.length+c+Ft.length,x=parseInt(u,10)+1-parseInt(l,10);i.push({headers:h,data:t.slice(d,d+x),offset:l,length:x,fileSize:g}),r=d+x+4}return i}class dr{async fetch(e,r=void 0){return Promise.all(e.map(n=>this.fetchSlice(n,r)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class Ri extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[r,n]of e)this.onEviction(r,n.value)}_deleteIfExpired(e,r){return typeof r.expiry=="number"&&r.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,r.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,r){if(this._deleteIfExpired(e,r)===!1)return r.value}_getItemValue(e,r){return r.expiry?this._getOrDeleteIfExpired(e,r):r.value}_peek(e,r){const n=r.get(e);return this._getItemValue(e,n)}_set(e,r){this.cache.set(e,r),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,r){this.oldCache.delete(e),this._set(e,r)}*_entriesAscending(){for(const e of this.oldCache){const[r,n]=e;this.cache.has(r)||this._deleteIfExpired(r,n)===!1&&(yield e)}for(const e of this.cache){const[r,n]=e;this._deleteIfExpired(r,n)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const r=this.cache.get(e);return this._getItemValue(e,r)}if(this.oldCache.has(e)){const r=this.oldCache.get(e);if(this._deleteIfExpired(e,r)===!1)return this._moveToRecent(e,r),r.value}}set(e,r,{maxAge:n=this.maxAge}={}){const i=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;return this.cache.has(e)?this.cache.set(e,{value:r,expiry:i}):this._set(e,{value:r,expiry:i}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const r=this.cache.delete(e);return r&&this._size--,this.oldCache.delete(e)||r}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const r=[...this._entriesAscending()],n=r.length-e;n<0?(this.cache=new Map(r),this.oldCache=new Map,this._size=r.length):(n>0&&this._emitEvictions(r.slice(0,n)),this.oldCache=new Map(r.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[r,n]=e;this._deleteIfExpired(r,n)===!1&&(yield[r,n.value])}for(const e of this.oldCache){const[r,n]=e;this.cache.has(r)||this._deleteIfExpired(r,n)===!1&&(yield[r,n.value])}}*entriesDescending(){let e=[...this.cache];for(let r=e.length-1;r>=0;--r){const n=e[r],[i,a]=n;this._deleteIfExpired(i,a)===!1&&(yield[i,a.value])}e=[...this.oldCache];for(let r=e.length-1;r>=0;--r){const n=e[r],[i,a]=n;this.cache.has(i)||this._deleteIfExpired(i,a)===!1&&(yield[i,a.value])}}*entriesAscending(){for(const[e,r]of this._entriesAscending())yield[e,r.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const r of this.oldCache.keys())this.cache.has(r)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,r=this){for(const[n,i]of this.entriesAscending())e.call(r,i,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function Fi(t){return new Promise(e=>setTimeout(e,t))}function Bi(t,e){const r=Array.isArray(t)?t:Array.from(t),n=Array.isArray(e)?e:Array.from(e);return r.map((i,a)=>[i,n[a]])}class se extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,se),this.name="AbortError"}}class Gi extends Error{constructor(e,r){super(r),this.errors=e,this.message=r,this.name="AggregateError"}}const Ui=Gi;class Li{constructor(e,r,n=null){this.offset=e,this.length=r,this.data=n}get top(){return this.offset+this.length}}class Bt{constructor(e,r,n){this.offset=e,this.length=r,this.blockIds=n}}class zi extends dr{constructor(e,{blockSize:r=65536,cacheSize:n=100}={}){super(),this.source=e,this.blockSize=r,this.blockCache=new Ri({maxSize:n,onEviction:(i,a)=>{this.evictedBlocks.set(i,a)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,r){const n=[],i=[],a=[];this.evictedBlocks.clear();for(const{offset:u,length:g}of e){let d=u+g;const{fileSize:x}=this;x!==null&&(d=Math.min(d,x));const m=Math.floor(u/this.blockSize)*this.blockSize;for(let p=m;p<d;p+=this.blockSize){const y=Math.floor(p/this.blockSize);!this.blockCache.has(y)&&!this.blockRequests.has(y)&&(this.blockIdsToFetch.add(y),i.push(y)),this.blockRequests.has(y)&&n.push(this.blockRequests.get(y)),a.push(y)}}await Fi(),this.fetchBlocks(r);const s=[];for(const u of i)this.blockRequests.has(u)&&s.push(this.blockRequests.get(u));await Promise.allSettled(n),await Promise.allSettled(s);const o=[],f=a.filter(u=>this.abortedBlockIds.has(u)||!this.blockCache.has(u));if(f.forEach(u=>this.blockIdsToFetch.add(u)),f.length>0&&r&&!r.aborted){this.fetchBlocks(null);for(const u of f){const g=this.blockRequests.get(u);if(!g)throw new Error(`Block ${u} is not in the block requests`);o.push(g)}await Promise.allSettled(o)}if(r&&r.aborted)throw new se("Request was aborted");const c=a.map(u=>this.blockCache.get(u)||this.evictedBlocks.get(u)),h=c.filter(u=>!u);if(h.length)throw new Ui(h,"Request failed");const l=new Map(Bi(a,c));return this.readSliceData(e,l)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const r=this.groupBlocks(this.blockIdsToFetch),n=this.source.fetch(r,e);for(let i=0;i<r.length;++i){const a=r[i];for(const s of a.blockIds)this.blockRequests.set(s,(async()=>{try{const o=(await n)[i],f=s*this.blockSize,c=f-o.offset,h=Math.min(c+this.blockSize,o.data.byteLength),l=o.data.slice(c,h),u=new Li(f,l.byteLength,l,s);this.blockCache.set(s,u),this.abortedBlockIds.delete(s)}catch(o){if(o.name==="AbortError")o.signal=e,this.blockCache.delete(s),this.abortedBlockIds.add(s);else throw o}finally{this.blockRequests.delete(s)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const r=Array.from(e).sort((s,o)=>s-o);if(r.length===0)return[];let n=[],i=null;const a=[];for(const s of r)i===null||i+1===s?(n.push(s),i=s):(a.push(new Bt(n[0]*this.blockSize,n.length*this.blockSize,n)),n=[s],i=s);return a.push(new Bt(n[0]*this.blockSize,n.length*this.blockSize,n)),a}readSliceData(e,r){return e.map(n=>{let i=n.offset+n.length;this.fileSize!==null&&(i=Math.min(this.fileSize,i));const a=Math.floor(n.offset/this.blockSize),s=Math.floor((i-1)/this.blockSize),o=new ArrayBuffer(n.length),f=new Uint8Array(o);for(let c=a;c<=s;++c){const h=r.get(c),l=h.offset-n.offset,u=h.top-i;let g=0,d=0,x;l<0?g=-l:l>0&&(d=l),u<0?x=h.length-g:x=i-h.offset-g;const m=new Uint8Array(h.data,g,x);f.set(m,d)}return o})}}class ut{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class dt{constructor(e){this.url=e}async request({headers:e,signal:r}={}){throw new Error("request is not implemented")}}class $i extends ut{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class Vi extends dt{constructor(e,r){super(e),this.credentials=r}async request({headers:e,signal:r}={}){const n=await fetch(this.url,{headers:e,credentials:this.credentials,signal:r});return new $i(n)}}class qi extends ut{constructor(e,r){super(),this.xhr=e,this.data=r}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class Ki extends dt{constructRequest(e,r){return new Promise((n,i)=>{const a=new XMLHttpRequest;a.open("GET",this.url),a.responseType="arraybuffer";for(const[s,o]of Object.entries(e))a.setRequestHeader(s,o);a.onload=()=>{const s=a.response;n(new qi(a,s))},a.onerror=i,a.onabort=()=>i(new se("Request aborted")),a.send(),r&&(r.aborted&&a.abort(),r.addEventListener("abort",()=>a.abort()))})}async request({headers:e,signal:r}={}){return await this.constructRequest(e,r)}}const Ve={};class Hi extends ut{constructor(e,r){super(),this.response=e,this.dataPromise=r}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class Yi extends dt{constructor(e){super(e),this.parsedUrl=Ve.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",Ve)}constructRequest(e,r){return new Promise((n,i)=>{const a=this.httpApi.get({...this.parsedUrl,headers:e},s=>{const o=new Promise(f=>{const c=[];s.on("data",h=>{c.push(h)}),s.on("end",()=>{const h=Buffer.concat(c).buffer;f(h)}),s.on("error",i)});n(new Hi(s,o))});a.on("error",i),r&&(r.aborted&&a.destroy(new se("Request aborted")),r.addEventListener("abort",()=>a.destroy(new se("Request aborted"))))})}async request({headers:e,signal:r}={}){return await this.constructRequest(e,r)}}class gt extends dr{constructor(e,r,n,i){super(),this.client=e,this.headers=r,this.maxRanges=n,this.allowFullFile=i,this._fileSize=null}async fetch(e,r){return this.maxRanges>=e.length?this.fetchSlices(e,r):(this.maxRanges>0&&e.length>1,Promise.all(e.map(n=>this.fetchSlice(n,r))))}async fetchSlices(e,r){const n=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:i,length:a})=>`${i}-${i+a}`).join(",")}`},signal:r});if(n.ok)if(n.status===206){const{type:i,params:a}=Pi(n.getHeader("content-type"));if(i==="multipart/byteranges"){const l=Oi(await n.getData(),a.boundary);return this._fileSize=l[0].fileSize||null,l}const s=await n.getData(),{start:o,end:f,total:c}=We(n.getHeader("content-range"));this._fileSize=c||null;const h=[{data:s,offset:o,length:f-o}];if(e.length>1){const l=await Promise.all(e.slice(1).map(u=>this.fetchSlice(u,r)));return h.concat(l)}return h}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const i=await n.getData();return this._fileSize=i.byteLength,[{data:i,offset:0,length:i.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,r){const{offset:n,length:i}=e,a=await this.client.request({headers:{...this.headers,Range:`bytes=${n}-${n+i}`},signal:r});if(a.ok)if(a.status===206){const s=await a.getData(),{total:o}=We(a.getHeader("content-range"));return this._fileSize=o||null,{data:s,offset:n,length:i}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const s=await a.getData();return this._fileSize=s.byteLength,{data:s,offset:0,length:s.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function bt(t,{blockSize:e,cacheSize:r}){return e===null?t:new zi(t,{blockSize:e,cacheSize:r})}function Xi(t,{headers:e={},credentials:r,maxRanges:n=0,allowFullFile:i=!1,...a}={}){const s=new Vi(t,r),o=new gt(s,e,n,i);return bt(o,a)}function Zi(t,{headers:e={},maxRanges:r=0,allowFullFile:n=!1,...i}={}){const a=new Ki(t),s=new gt(a,e,r,n);return bt(s,i)}function Ji(t,{headers:e={},maxRanges:r=0,allowFullFile:n=!1,...i}={}){const a=new Yi(t),s=new gt(a,e,r,n);return bt(s,i)}function Qi(t,{forceXHR:e=!1,...r}={}){return typeof fetch=="function"&&!e?Xi(t,r):typeof XMLHttpRequest<"u"?Zi(t,r):Ji(t,r)}function et(t){switch(t){case M.BYTE:case M.ASCII:case M.SBYTE:case M.UNDEFINED:return 1;case M.SHORT:case M.SSHORT:return 2;case M.LONG:case M.SLONG:case M.FLOAT:case M.IFD:return 4;case M.RATIONAL:case M.SRATIONAL:case M.DOUBLE:case M.LONG8:case M.SLONG8:case M.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${t}`)}}function Wi(t){const e=t.GeoKeyDirectory;if(!e)return null;const r={};for(let n=4;n<=e[3]*4;n+=4){const i=fi[e[n]],a=e[n+1]?ue[e[n+1]]:null,s=e[n+2],o=e[n+3];let f=null;if(!a)f=o;else{if(f=t[a],typeof f>"u"||f===null)throw new Error(`Could not get value of geoKey '${i}'.`);typeof f=="string"?f=f.substring(o,o+s-1):f.subarray&&(f=f.subarray(o,o+s),s===1&&(f=f[0]))}r[i]=f}return r}function re(t,e,r,n){let i=null,a=null;const s=et(e);switch(e){case M.BYTE:case M.ASCII:case M.UNDEFINED:i=new Uint8Array(r),a=t.readUint8;break;case M.SBYTE:i=new Int8Array(r),a=t.readInt8;break;case M.SHORT:i=new Uint16Array(r),a=t.readUint16;break;case M.SSHORT:i=new Int16Array(r),a=t.readInt16;break;case M.LONG:case M.IFD:i=new Uint32Array(r),a=t.readUint32;break;case M.SLONG:i=new Int32Array(r),a=t.readInt32;break;case M.LONG8:case M.IFD8:i=new Array(r),a=t.readUint64;break;case M.SLONG8:i=new Array(r),a=t.readInt64;break;case M.RATIONAL:i=new Uint32Array(r*2),a=t.readUint32;break;case M.SRATIONAL:i=new Int32Array(r*2),a=t.readInt32;break;case M.FLOAT:i=new Float32Array(r),a=t.readFloat32;break;case M.DOUBLE:i=new Float64Array(r),a=t.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===M.RATIONAL||e===M.SRATIONAL)for(let o=0;o<r;o+=2)i[o]=a.call(t,n+o*s),i[o+1]=a.call(t,n+(o*s+4));else for(let o=0;o<r;++o)i[o]=a.call(t,n+o*s);return e===M.ASCII?new TextDecoder("utf-8").decode(i):i}class ea{constructor(e,r,n,i){this.fileDirectory=e,this.rawFileDirectory=r,this.geoKeyDirectory=n,this.nextIFDByteOffset=i}}class Ie extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class ta{async readRasters(e={}){const{window:r,width:n,height:i}=e;let{resX:a,resY:s,bbox:o}=e;const f=await this.getImage();let c=f;const h=await this.getImageCount(),l=f.getBoundingBox();if(r&&o)throw new Error('Both "bbox" and "window" passed.');if(n||i){if(r){const[d,x]=f.getOrigin(),[m,p]=f.getResolution();o=[d+r[0]*m,x+r[1]*p,d+r[2]*m,x+r[3]*p]}const g=o||l;if(n){if(a)throw new Error("Both width and resX passed");a=(g[2]-g[0])/n}if(i){if(s)throw new Error("Both width and resY passed");s=(g[3]-g[1])/i}}if(a||s){const g=[];for(let d=0;d<h;++d){const x=await this.getImage(d),{SubfileType:m,NewSubfileType:p}=x.fileDirectory;(d===0||m===2||p&1)&&g.push(x)}g.sort((d,x)=>d.getWidth()-x.getWidth());for(let d=0;d<g.length;++d){const x=g[d],m=(l[2]-l[0])/x.getWidth(),p=(l[3]-l[1])/x.getHeight();if(c=x,a&&a>m||s&&s>p)break}}let u=r;if(o){const[g,d]=f.getOrigin(),[x,m]=c.getResolution(f);u=[Math.round((o[0]-g)/x),Math.round((o[1]-d)/m),Math.round((o[2]-g)/x),Math.round((o[3]-d)/m)],u=[Math.min(u[0],u[2]),Math.min(u[1],u[3]),Math.max(u[0],u[2]),Math.max(u[1],u[3])]}return c.readRasters({...e,window:u})}}class mt extends ta{constructor(e,r,n,i,a={}){super(),this.source=e,this.littleEndian=r,this.bigTiff=n,this.firstIFDOffset=i,this.cache=a.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,r){const n=this.bigTiff?4048:1024;return new Ni((await this.source.fetch([{offset:e,length:typeof r<"u"?r:n}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const r=this.bigTiff?20:12,n=this.bigTiff?8:2;let i=await this.getSlice(e);const a=this.bigTiff?i.readUint64(e):i.readUint16(e),s=a*r+(this.bigTiff?16:6);i.covers(e,s)||(i=await this.getSlice(e,s));const o={},f=new Map;let c=e+(this.bigTiff?8:2);for(let u=0;u<a;c+=r,++u){const g=i.readUint16(c),d=i.readUint16(c+2),x=this.bigTiff?i.readUint64(c+4):i.readUint32(c+4);let m,p;const y=et(d),w=c+(this.bigTiff?12:8);if(y*x<=(this.bigTiff?8:4))m=re(i,d,x,w);else{const S=i.readOffset(w),A=et(d)*x;if(i.covers(S,A))m=re(i,d,x,S);else{const v=await this.getSlice(S,A);m=re(v,d,x,S)}}x===1&&oi.indexOf(g)===-1&&!(d===M.RATIONAL||d===M.SRATIONAL)?p=m[0]:p=m;const I=ue[g];I&&(o[I]=p),f.set(g,p)}const h=Wi(o),l=i.readOffset(e+n+r*a);return new ea(o,f,h,l)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(r){throw r instanceof Ie?new Ie(e):r}return this.ifdRequests[e]=(async()=>{const r=await this.ifdRequests[e-1];if(r.nextIFDByteOffset===0)throw new Ie(e);return this.parseFileDirectoryAt(r.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const r=await this.requestIFD(e);return new _i(r.fileDirectory,r.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,r=!0;for(;r;)try{await this.requestIFD(e),++e}catch(n){if(n instanceof Ie)r=!1;else throw n}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const r="GDAL_STRUCTURAL_METADATA_SIZE=",n=r.length+100;let i=await this.getSlice(e,n);if(r===re(i,M.ASCII,r.length,e)){const s=re(i,M.ASCII,n,e).split(`
`)[0],o=Number(s.split("=")[1].split(" ")[0])+s.length;o>n&&(i=await this.getSlice(e,o));const f=re(i,M.ASCII,o,e);this.ghostValues={},f.split(`
`).filter(c=>c.length>0).map(c=>c.split("=")).forEach(([c,h])=>{this.ghostValues[c]=h})}return this.ghostValues}static async fromSource(e,r,n){const i=(await e.fetch([{offset:0,length:1024}],n))[0],a=new vi(i),s=a.getUint16(0,0);let o;if(s===18761)o=!0;else if(s===19789)o=!1;else throw new TypeError("Invalid byte order value.");const f=a.getUint16(2,o);let c;if(f===42)c=!1;else if(f===43){if(c=!0,a.getUint16(4,o)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const h=c?a.getUint64(8,o):a.getUint32(4,o);return new mt(e,o,c,h,r)}close(){return typeof this.source.close=="function"?this.source.close():!1}}async function ra(t,e={},r){return mt.fromSource(Qi(t,e),r)}const Ae=50,gr=t=>{const[e,r]=F.useState(null),[n,i]=F.useState(null);F.useEffect(()=>{t&&(async()=>{try{const f=await(await ra(t)).getImage(),c=f.getWidth(),h=f.getHeight(),[l]=await f.readRasters(),u=f.getGDALNoData(),g=l.filter(S=>S!==u),d=Pr(g),x=l.map(S=>S===u?d[0]:S),m=c/h,p=m>=1?Ae:Ae*m,y=m>=1?Ae/m:Ae,w={width:p,height:y,widthSegments:c-1,heightSegments:h-1,values:x,yDomain:d};r(w);const I={xScale:P().domain([0,w.widthSegments]).range([-w.width/2,w.width/2]),yScale:P().domain(w.yDomain).range([0,5]),zScale:P().domain([0,w.heightSegments]).range([-w.height/2,w.height/2]),domain:{xMin:0,xMax:w.widthSegments,yMin:w.yDomain[0],yMax:w.yDomain[1],zMin:0,zMax:w.heightSegments}};i(I)}catch(o){console.error("Error loading GeoTIFF:",o)}})()},[t]);const a=F.useMemo(()=>{if(!n)return null;const s=n.yScale.domain(),o=n.yScale.ticks(10).map(f=>{const c=(f-s[0])/(s[1]-s[0]);return Pn(c)});return P().domain(n.yScale.ticks(10)).range(o).clamp(!0)},[n]);return{surfaceData:e,scales:n,colorScale:a}};var Gt={},qe={},Ke=34,he=10,He=13;function br(t){return new Function("d","return {"+t.map(function(e,r){return JSON.stringify(e)+": d["+r+'] || ""'}).join(",")+"}")}function na(t,e){var r=br(t);return function(n,i){return e(r(n),i,t)}}function Ut(t){var e=Object.create(null),r=[];return t.forEach(function(n){for(var i in n)i in e||r.push(e[i]=i)}),r}function N(t,e){var r=t+"",n=r.length;return n<e?new Array(e-n+1).join(0)+r:r}function ia(t){return t<0?"-"+N(-t,6):t>9999?"+"+N(t,6):N(t,4)}function aa(t){var e=t.getUTCHours(),r=t.getUTCMinutes(),n=t.getUTCSeconds(),i=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":ia(t.getUTCFullYear())+"-"+N(t.getUTCMonth()+1,2)+"-"+N(t.getUTCDate(),2)+(i?"T"+N(e,2)+":"+N(r,2)+":"+N(n,2)+"."+N(i,3)+"Z":n?"T"+N(e,2)+":"+N(r,2)+":"+N(n,2)+"Z":r||e?"T"+N(e,2)+":"+N(r,2)+"Z":"")}function sa(t){var e=new RegExp('["'+t+`
\r]`),r=t.charCodeAt(0);function n(l,u){var g,d,x=i(l,function(m,p){if(g)return g(m,p-1);d=m,g=u?na(m,u):br(m)});return x.columns=d||[],x}function i(l,u){var g=[],d=l.length,x=0,m=0,p,y=d<=0,w=!1;l.charCodeAt(d-1)===he&&--d,l.charCodeAt(d-1)===He&&--d;function I(){if(y)return qe;if(w)return w=!1,Gt;var A,v=x,k;if(l.charCodeAt(v)===Ke){for(;x++<d&&l.charCodeAt(x)!==Ke||l.charCodeAt(++x)===Ke;);return(A=x)>=d?y=!0:(k=l.charCodeAt(x++))===he?w=!0:k===He&&(w=!0,l.charCodeAt(x)===he&&++x),l.slice(v+1,A-1).replace(/""/g,'"')}for(;x<d;){if((k=l.charCodeAt(A=x++))===he)w=!0;else if(k===He)w=!0,l.charCodeAt(x)===he&&++x;else if(k!==r)continue;return l.slice(v,A)}return y=!0,l.slice(v,d)}for(;(p=I())!==qe;){for(var S=[];p!==Gt&&p!==qe;)S.push(p),p=I();u&&(S=u(S,m++))==null||g.push(S)}return g}function a(l,u){return l.map(function(g){return u.map(function(d){return h(g[d])}).join(t)})}function s(l,u){return u==null&&(u=Ut(l)),[u.map(h).join(t)].concat(a(l,u)).join(`
`)}function o(l,u){return u==null&&(u=Ut(l)),a(l,u).join(`
`)}function f(l){return l.map(c).join(`
`)}function c(l){return l.map(h).join(t)}function h(l){return l==null?"":l instanceof Date?aa(l):e.test(l+="")?'"'+l.replace(/"/g,'""')+'"':l}return{parse:n,parseRows:i,format:s,formatBody:o,formatRows:f,formatRow:c,formatValue:h}}var oa=sa(","),ca=oa.parse;function fa(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function la(t,e){return fetch(t,e).then(fa)}function ha(t){return function(e,r,n){return arguments.length===2&&typeof r=="function"&&(n=r,r=void 0),la(e,r).then(function(i){return t(i,n)})}}var ua=ha(ca);const mr=t=>{const[e,r]=F.useState({surfaceData:null,scales:null,colorScale:null});return F.useEffect(()=>{t&&ua(t).then(n=>{const i=n.columns.slice(1),a=i.length,s=n.length,o=[];let f=1/0,c=-1/0;n.forEach(x=>{i.forEach(m=>{const p=+x[m];o.push(p),p<f&&(f=p),p>c&&(c=p)})});const h={width:a,height:s,values:o,min:f,max:c,widthSegments:a-1,heightSegments:s-1},l=[-15,15],u=[0,10],g={xScale:P().domain([0,a-1]).range(l),yScale:P().domain([f,c]).range(u),zScale:P().domain([0,s-1]).range(l),domain:{xMin:0,xMax:a-1,yMin:f,yMax:c,zMin:0,zMax:s-1}},d=st([f,c],Qt);r({surfaceData:h,scales:g,colorScale:d})})},[t]),e},Be=({scales:t,domain:e})=>{const{xScale:r,yScale:n,zScale:i}=t,{xMin:a,xMax:s,yMin:o,yMax:f,zMin:c,zMax:h}=e,l="black",u="#cccccc",g=r.ticks(5),d=n.ticks(5),x=i.ticks(5);return b.jsxs("group",{children:[b.jsxs("line",{children:[b.jsx("bufferGeometry",{children:b.jsx("bufferAttribute",{attach:"attributes-position",count:2,array:new Float32Array([r(a),n(o),i(c),r(s),n(o),i(c)]),itemSize:3})}),b.jsx("lineBasicMaterial",{color:l})]}),g.map((m,p)=>b.jsxs("group",{position:[r(m),n(o),i(c)],children:[b.jsxs("line",{position:[0,0,(i(h)-i(c))/2],children:[b.jsx("bufferGeometry",{children:b.jsx("bufferAttribute",{attach:"attributes-position",count:2,array:new Float32Array([0,0,-(i(h)-i(c))/2,0,0,(i(h)-i(c))/2]),itemSize:3})}),b.jsx("lineBasicMaterial",{color:u,transparent:!0,opacity:.5})]}),b.jsx(te,{position:[0,-.5,0],fontSize:.5,color:"black",anchorX:"center",anchorY:"top",children:m})]},`x-${p}`)),b.jsx(te,{position:[r(s)+2,n(o),i(c)],fontSize:1,color:"black",children:"X"}),b.jsxs("line",{children:[b.jsx("bufferGeometry",{children:b.jsx("bufferAttribute",{attach:"attributes-position",count:2,array:new Float32Array([r(a),n(o),i(c),r(a),n(f),i(c)]),itemSize:3})}),b.jsx("lineBasicMaterial",{color:l})]}),d.map((m,p)=>b.jsxs("group",{position:[r(a),n(m),i(c)],children:[b.jsxs("line",{position:[(r(s)-r(a))/2,0,0],children:[b.jsx("bufferGeometry",{children:b.jsx("bufferAttribute",{attach:"attributes-position",count:2,array:new Float32Array([-(r(s)-r(a))/2,0,0,(r(s)-r(a))/2,0,0]),itemSize:3})}),b.jsx("lineBasicMaterial",{color:u,transparent:!0,opacity:.5})]}),b.jsx(te,{position:[-.8,0,0],fontSize:.5,color:"black",anchorX:"right",anchorY:"middle",children:m})]},`y-${p}`)),b.jsx(te,{position:[r(a),n(f)+2,i(c)],fontSize:1,color:"black",children:"Y"}),b.jsxs("line",{children:[b.jsx("bufferGeometry",{children:b.jsx("bufferAttribute",{attach:"attributes-position",count:2,array:new Float32Array([r(a),n(o),i(c),r(a),n(o),i(h)]),itemSize:3})}),b.jsx("lineBasicMaterial",{color:l})]}),x.map((m,p)=>b.jsxs("group",{position:[r(a),n(o),i(m)],children:[b.jsxs("line",{position:[0,(n(f)-n(o))/2,0],children:[b.jsx("bufferGeometry",{children:b.jsx("bufferAttribute",{attach:"attributes-position",count:2,array:new Float32Array([0,-(n(f)-n(o))/2,0,0,(n(f)-n(o))/2,0]),itemSize:3})}),b.jsx("lineBasicMaterial",{color:u,transparent:!0,opacity:.5})]}),b.jsx(te,{position:[-.8,0,0],rotation:[0,-Math.PI/2,0],fontSize:.5,color:"black",anchorX:"right",anchorY:"middle",children:m})]},`z-${p}`)),b.jsx(te,{position:[r(a),n(o),i(h)+2],fontSize:1,color:"black",children:"Z"})]})},xr=({data:t,scales:e,colorScale:r})=>{const{yScale:n}=e,{width:i,height:a,widthSegments:s,heightSegments:o}=t,f=F.useMemo(()=>{if(!r)return new yt;const c=new yt(i,a,s,o);c.rotateX(-Math.PI/2);const h=c.attributes.position.array,l=[];for(let u=0;u<=o;u++)for(let g=0;g<=s;g++){const d=u*(s+1)+g,x=t.values[d]||0;h[d*3+1]=n(x);const m=new kr(r(x));l.push(m.r,m.g,m.b)}return c.setAttribute("color",new Dr(l,3)),c.computeVertexNormals(),c},[i,a,s,o,n,t,r]);return b.jsx("mesh",{geometry:f,children:b.jsx("meshStandardMaterial",{vertexColors:!0,side:Er,roughness:.5})})};function da(){const{surfaceData:t,scales:e,colorScale:r}=gr("/data/sado_dem.tif");return!t||!e?null:b.jsxs(b.Fragment,{children:[b.jsx("color",{attach:"background",args:["#f0f0f0"]}),b.jsx("ambientLight",{intensity:.8}),b.jsx("directionalLight",{castShadow:!0,position:[50,50,50],intensity:1.5,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-camera-far":150,"shadow-camera-left":-50,"shadow-camera-right":50,"shadow-camera-top":50,"shadow-camera-bottom":-50}),b.jsx("directionalLight",{position:[-50,-30,-50],intensity:.5}),b.jsx(je,{makeDefault:!0}),b.jsxs("group",{children:[b.jsx(Be,{scales:e,domain:e.domain}),b.jsx(xr,{data:t,scales:e,colorScale:r})]})]})}const ga=({data:t,scales:e,colorScale:r})=>{const{xScale:n,yScale:i,zScale:a}=e;return b.jsxs(Lt,{children:[b.jsx("boxGeometry",{args:[.5,1,.5]}),b.jsx("meshStandardMaterial",{roughness:.5}),t.map(s=>{const o=i(s.y)-i(0);return b.jsx(zt,{color:r(s.y),position:[n(s.x),i(0)+o/2,a(s.z)],scale:[1,o,1],onClick:f=>{f.stopPropagation(),console.log("Clicked:",s)}},s.id)})]})},tt=10,rt=10,ba=()=>{const t=[];let e=0;for(let r=0;r<tt;r++)for(let n=0;n<rt;n++)t.push({x:r,y:Math.random()*100,z:n,id:e++});return t};function ma({colorScale:t}){const e=F.useMemo(()=>ba(),[]),r=F.useMemo(()=>{const n=[-10,10],i=[0,15];return{xScale:P().domain([0,tt-1]).range(n),yScale:P().domain([0,100]).range(i),zScale:P().domain([0,rt-1]).range(n),domain:{xMin:0,xMax:tt-1,yMin:0,yMax:100,zMin:0,zMax:rt-1}}},[]);return b.jsxs(b.Fragment,{children:[b.jsx("color",{attach:"background",args:["#f0f0f0"]}),b.jsx("ambientLight",{intensity:.5}),b.jsx("pointLight",{position:[50,50,50],intensity:1,castShadow:!0}),b.jsx(je,{makeDefault:!0}),b.jsxs("group",{children:[b.jsx(Be,{scales:r,domain:r.domain}),b.jsx(ga,{data:e,scales:r,colorScale:t})]})]})}const xa=({data:t,scales:e,point_size:r,colorScale:n})=>{const{xScale:i,yScale:a,zScale:s}=e;return b.jsx("group",{children:b.jsxs(Lt,{children:[b.jsx("sphereGeometry",{args:[r,16,16]}),b.jsx("meshStandardMaterial",{roughness:.5}),t.map(o=>b.jsx(zt,{position:[i(o.x),a(o.y),s(o.z)],color:n(o.y),onClick:f=>{f.stopPropagation(),console.log("Clicked:",o)}},o.id))]})})},pa=(t,e,r)=>{const n=[];let i=0;for(let a=0;a<t;a++)for(let s=0;s<e;s++)for(let o=0;o<r;o++)n.push({x:a,y:Math.random()*100,z:o,id:i++});return n},ya=({colorScale:t})=>{const a=pt.useMemo(()=>pa(10,10,10),[10,10,10]),s=pt.useMemo(()=>{const o=[-10,10],f=[0,15];return{xScale:P().domain([0,9]).range(o),yScale:P().domain([0,100]).range(f),zScale:P().domain([0,9]).range(o),domain:{xMin:0,xMax:9,yMin:0,yMax:100,zMin:0,zMax:9}}},[10,10]);return b.jsxs(b.Fragment,{children:[b.jsx("color",{attach:"background",args:["#f0f0f0"]}),b.jsx("ambientLight",{intensity:.5}),b.jsx("pointLight",{position:[50,50,50],intensity:1,castShadow:!0}),b.jsx(je,{makeDefault:!0}),b.jsxs("group",{children:[b.jsx(Be,{scales:s,domain:s.domain}),b.jsx(xa,{data:a,scales:s,point_size:.5,colorScale:t})]})]})},wa=()=>{const{surfaceData:t,scales:e,colorScale:r}=mr("/data/mt_bruno_elevation.csv");return!t||!e?null:b.jsxs(b.Fragment,{children:[b.jsx("color",{attach:"background",args:["#f0f0f0"]}),b.jsx("ambientLight",{intensity:.5}),b.jsx("pointLight",{position:[50,50,50],castShadow:!0}),b.jsx(je,{makeDefault:!0}),b.jsxs("group",{children:[b.jsx(Be,{scales:e,domain:e.domain}),b.jsx(xr,{data:t,scales:e,colorScale:r})]})]})},Sa=({yScale:t,colorScale:e})=>{if(!t||!e)return null;const r=t.ticks(5),n=200,i=20,a=`linear-gradient(to top, ${e.range().join(", ")})`;return b.jsxs("div",{style:{position:"absolute",top:"50%",right:"50px",color:"#366",transform:"translateY(-50%)",display:"flex",alignItems:"center"},children:[b.jsx("div",{style:{width:i,height:n,background:a}}),b.jsx("div",{style:{marginLeft:"5px",height:n,position:"relative"},children:r.map((s,o)=>{const f=(s-t.domain()[0])/(t.domain()[1]-t.domain()[0]);return b.jsxs("div",{style:{position:"absolute",bottom:`${f*100}%`,transform:"translateY(50%)",fontSize:"12px"},children:["- ",Math.round(s)]},o)})})]})};function Ma(){const[t,e]=F.useState("surface"),{scales:r,colorScale:n}=gr("./data/sado_dem.tif")||{},{scales:i,colorScale:a}=mr("./data/mt_bruno_elevation.csv")||{},s=F.useMemo(()=>st([0,100],Qt),[]),o={surface:{yScale:r?.yScale,colorScale:n},"csv-surface":{yScale:i?.yScale,colorScale:a}}[t];return b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:"app-header",children:[b.jsx("h1",{className:"app-title",children:"3D Chart Demo"}),b.jsxs("p",{className:"info-text",children:["Left Click: Rotate",b.jsx("br",{}),"Right Click: Pan",b.jsx("br",{}),"Scroll: Zoom"]}),b.jsxs("div",{className:"chart-selector",children:[b.jsx("button",{onClick:()=>e("surface"),disabled:t==="surface",children:"GeoTIFF Surface"}),b.jsx("button",{onClick:()=>e("csv-surface"),disabled:t==="csv-surface",children:"CSV Surface"}),b.jsx("button",{onClick:()=>e("bar"),disabled:t==="bar",children:"Bar Chart"}),b.jsx("button",{onClick:()=>e("scatter"),disabled:t==="scatter",children:"Scatter Chart"})]})]}),b.jsxs(Ir,{shadows:!0,camera:{position:[20,20,30],fov:45},children:[t==="surface"&&b.jsx(da,{}),t==="csv-surface"&&b.jsx(wa,{}),t==="bar"&&b.jsx(ma,{colorScale:s}),t==="scatter"&&b.jsx(ya,{colorScale:s})]}),o&&b.jsx(Sa,{yScale:o.yScale,colorScale:o.colorScale})]})}Ar.createRoot(document.getElementById("root")).render(b.jsx(F.StrictMode,{children:b.jsx(Ma,{})}));export{Da as L,Ea as a};
